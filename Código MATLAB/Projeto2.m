
%% Projeto 1:
% Projetar um enlace de radio entre duas localidades. Escolher qualquer
% ponto nas localidades. Fornecer a elevacao, latitude e longitude dos
% pontos. Calcular os parametros da 1a zona de Fresnel. Dica: utilizar um
% site que fornece as coordenadas e altitude de terrenos, como o
% www.mapcoordinates.net/pt ou www.freemaptools.com/elevation-finder.htm.
% Especifique todos os parametros, como diametro de antenas parabolicas de
% transmissao e recepcao e respectivos ganhos; regiao de chuva especificado
% pelo ITU; especificacoes da zona de Fresnel, com mapa ou esboco de
% terreno; potencias de transmissao e recepcao; qualidade do enlace (fazer
% o projeto para que a qualidade do sinal recebido produza qualidade maxima
% para a modulacao e taxa de bit desejada); atenuacao no percurso; margem
% do enlace. Se for preciso, utilize padrao Ethernet para os pacotes. Ao
% fazer o projeto, pense que o esta executando para um cliente que devera
% comprar equipamento no mercado, instalar de acordo com o projeto e testar
% o enlace para verificar se a qualidade do sinal eh a prometida. Uma boa
% referencia eh o artigo "Satellite Link Design: A Tutorial"
% (http://www.ijens.org/vol_11_i_04/110904-3232-ijecs-ijens.pdf).

%% Programa:
% Definindo variaveis:
f = 13e9; %Hz
c = 3e8; %m/s
lambda = c/f; %m
% Modulacao 8-PSK -> Eb/N0 = 13dB p/ 10e^-5 ou 14dB p/ 10e^-6
Rb = 13.2e6; %bps
% Enlace entre Sao Carlos e Matao
% chuva: 145mm/h

% Coordenadas e Altitude dos pontos:
% Sao Carlos: 22o00'45.1"S 047o53'24.7"W, altitude: 871m
% Matao: 21o36'26.9"S 048o22'09.7"W, altitude: 599m

% Perfil de elevacao entre as coordenadas:
% ref.: http://www.geocontext.org/publ/2010/04/profiler/en/
d = 1e-3*[0
    131.0658253
    262.1316506
    393.1974759
    524.2633012
    655.3291265
    786.3949518
    917.4607771
    1048.526602
    1179.592428
    1310.658253
    1441.724078
    1572.789904
    1703.855729
    1834.921554
    1965.98738
    2097.053205
    2228.11903
    2359.184855
    2490.250681
    2621.316506
    2752.382331
    2883.448157
    3014.513982
    3145.579807
    3276.645633
    3407.711458
    3538.777283
    3669.843108
    3800.908934
    3931.974759
    4063.040584
    4194.10641
    4325.172235
    4456.23806
    4587.303886
    4718.369711
    4849.435536
    4980.501361
    5111.567187
    5242.633012
    5373.698837
    5504.764663
    5635.830488
    5766.896313
    5897.962139
    6029.027964
    6160.093789
    6291.159614
    6422.22544
    6553.291265
    6684.35709
    6815.422916
    6946.488741
    7077.554566
    7208.620392
    7339.686217
    7470.752042
    7601.817868
    7732.883693
    7863.949518
    7995.015343
    8126.081169
    8257.146994
    8388.212819
    8519.278645
    8650.34447
    8781.410295
    8912.476121
    9043.541946
    9174.607771
    9305.673596
    9436.739422
    9567.805247
    9698.871072
    9829.936898
    9961.002723
    10092.06855
    10223.13437
    10354.2002
    10485.26602
    10616.33185
    10747.39767
    10878.4635
    11009.52933
    11140.59515
    11271.66098
    11402.7268
    11533.79263
    11664.85845
    11795.92428
    11926.9901
    12058.05593
    12189.12175
    12320.18758
    12451.2534
    12582.31923
    12713.38505
    12844.45088
    12975.5167
    13106.58253
    13237.64836
    13368.71418
    13499.78001
    13630.84583
    13761.91166
    13892.97748
    14024.04331
    14155.10913
    14286.17496
    14417.24078
    14548.30661
    14679.37243
    14810.43826
    14941.50408
    15072.56991
    15203.63574
    15334.70156
    15465.76739
    15596.83321
    15727.89904
    15858.96486
    15990.03069
    16121.09651
    16252.16234
    16383.22816
    16514.29399
    16645.35981
    16776.42564
    16907.49146
    17038.55729
    17169.62311
    17300.68894
    17431.75477
    17562.82059
    17693.88642
    17824.95224
    17956.01807
    18087.08389
    18218.14972
    18349.21554
    18480.28137
    18611.34719
    18742.41302
    18873.47884
    19004.54467
    19135.61049
    19266.67632
    19397.74214
    19528.80797
    19659.8738
    19790.93962
    19922.00545
    20053.07127
    20184.1371
    20315.20292
    20446.26875
    20577.33457
    20708.4004
    20839.46622
    20970.53205
    21101.59787
    21232.6637
    21363.72952
    21494.79535
    21625.86117
    21756.927
    21887.99283
    22019.05865
    22150.12448
    22281.1903
    22412.25613
    22543.32195
    22674.38778
    22805.4536
    22936.51943
    23067.58525
    23198.65108
    23329.7169
    23460.78273
    23591.84855
    23722.91438
    23853.9802
    23985.04603
    24116.11186
    24247.17768
    24378.24351
    24509.30933
    24640.37516
    24771.44098
    24902.50681
    25033.57263
    25164.63846
    25295.70428
    25426.77011
    25557.83593
    25688.90176
    25819.96758
    25951.03341
    26082.09924
    26213.16506
    26344.23089
    26475.29671
    26606.36254
    26737.42836
    26868.49419
    26999.56001
    27130.62584
    27261.69166
    27392.75749
    27523.82331
    27654.88914
    27785.95496
    27917.02079
    28048.08661
    28179.15244
    28310.21827
    28441.28409
    28572.34992
    28703.41574
    28834.48157
    28965.54739
    29096.61322
    29227.67904
    29358.74487
    29489.81069
    29620.87652
    29751.94234
    29883.00817
    30014.07399
    30145.13982
    30276.20564
    30407.27147
    30538.3373
    30669.40312
    30800.46895
    30931.53477
    31062.6006
    31193.66642
    31324.73225
    31455.79807
    31586.8639
    31717.92972
    31848.99555
    31980.06137
    32111.1272
    32242.19302
    32373.25885
    32504.32467
    32635.3905
    32766.45633
    32897.52215
    33028.58798
    33159.6538
    33290.71963
    33421.78545
    33552.85128
    33683.9171
    33814.98293
    33946.04875
    34077.11458
    34208.1804
    34339.24623
    34470.31205
    34601.37788
    34732.44371
    34863.50953
    34994.57536
    35125.64118
    35256.70701
    35387.77283
    35518.83866
    35649.90448
    35780.97031
    35912.03613
    36043.10196
    36174.16778
    36305.23361
    36436.29943
    36567.36526
    36698.43108
    36829.49691
    36960.56274
    37091.62856
    37222.69439
    37353.76021
    37484.82604
    37615.89186
    37746.95769
    37878.02351
    38009.08934
    38140.15516
    38271.22099
    38402.28681
    38533.35264
    38664.41846
    38795.48429
    38926.55011
    39057.61594
    39188.68177
    39319.74759
    39450.81342
    39581.87924
    39712.94507
    39844.01089
    39975.07672
    40106.14254
    40237.20837
    40368.27419
    40499.34002
    40630.40584
    40761.47167
    40892.53749
    41023.60332
    41154.66914
    41285.73497
    41416.8008
    41547.86662
    41678.93245
    41809.99827
    41941.0641
    42072.12992
    42203.19575
    42334.26157
    42465.3274
    42596.39322
    42727.45905
    42858.52487
    42989.5907
    43120.65652
    43251.72235
    43382.78817
    43513.854
    43644.91983
    43775.98565
    43907.05148
    44038.1173
    44169.18313
    44300.24895
    44431.31478
    44562.3806
    44693.44643
    44824.51225
    44955.57808
    45086.6439
    45217.70973
    45348.77555
    45479.84138
    45610.90721
    45741.97303
    45873.03886
    46004.10468
    46135.17051
    46266.23633
    46397.30216
    46528.36798
    46659.43381
    46790.49963
    46921.56546
    47052.63128
    47183.69711
    47314.76293
    47445.82876
    47576.89458
    47707.96041
    47839.02624
    47970.09206
    48101.15789
    48232.22371
    48363.28954
    48494.35536
    48625.42119
    48756.48701
    48887.55284
    49018.61866
    49149.68449
    49280.75031
    49411.81614
    49542.88196
    49673.94779
    49805.01361
    49936.07944
    50067.14527
    50198.21109
    50329.27692
    50460.34274
    50591.40857
    50722.47439
    50853.54022
    50984.60604
    51115.67187
    51246.73769
    51377.80352
    51508.86934
    51639.93517
    51771.00099
    51902.06682
    52033.13264
    52164.19847
    52295.2643
    52426.33012
    52557.39595
    52688.46177
    52819.5276
    52950.59342
    53081.65925
    53212.72507
    53343.7909
    53474.85672
    53605.92255
    53736.98837
    53868.0542
    53999.12002
    54130.18585
    54261.25168
    54392.3175
    54523.38333
    54654.44915
    54785.51498
    54916.5808
    55047.64663
    55178.71245
    55309.77828
    55440.8441
    55571.90993
    55702.97575
    55834.04158
    55965.1074
    56096.17323
    56227.23905
    56358.30488
    56489.37071
    56620.43653
    56751.50236
    56882.56818
    57013.63401
    57144.69983
    57275.76566
    57406.83148
    57537.89731
    57668.96313
    57800.02896
    57931.09478
    58062.16061
    58193.22643
    58324.29226
    58455.35808
    58586.42391
    58717.48974
    58848.55556
    58979.62139
    59110.68721
    59241.75304
    59372.81886
    59503.88469
    59634.95051
    59766.01634
    59897.08216
    60028.14799
    60159.21381
    60290.27964
    60421.34546
    60552.41129
    60683.47711
    60814.54294
    60945.60877
    61076.67459
    61207.74042
    61338.80624
    61469.87207
    61600.93789
    61732.00372
    61863.06954
    61994.13537
    62125.20119
    62256.26702
    62387.33284
    62518.39867
    62649.46449
    62780.53032
    62911.59614
    63042.66197
    63173.7278
    63304.79362
    63435.85945
    63566.92527
    63697.9911
    63829.05692
    63960.12275
    64091.18857
    64222.2544
    64353.32022
    64484.38605
    64615.45187
    64746.5177
    64877.58352
    65008.64935
    65139.71518
    65270.781
    65401.84683
    65532.91265
    65663.97848
    65795.0443
    65926.11013
    66057.17595
    66188.24178
    66319.3076
    66450.37343
    66581.43925
    66712.50508
    66843.5709
    66974.63673];

a = [871.05
    872.3862915
    869.3804321
    863.5281982
    859.4896851
    862.2296143
    856.4181519
    847.430542
    836.6155396
    830.046814
    823.6184082
    811.1976318
    813.7814331
    821.732666
    828.1494141
    833.7988281
    836.7383423
    839.3403931
    843.3493652
    846.6891479
    849.0980835
    848.6343384
    845.8879395
    841.9906006
    840.2228394
    849.7200928
    861.8621216
    870.7284546
    869.6478882
    865.8455811
    865.1139526
    863.4443359
    859.5030518
    860.055481
    861.4517212
    860.2316895
    858.7759399
    859.9262695
    861.5684204
    864.2223511
    865.9562378
    866.0740356
    867.9597778
    865.9555664
    865.2651367
    865.3349609
    866.2446899
    866.3148804
    862.6489868
    860.0715942
    859.3052979
    854.8705444
    846.3764648
    844.7324219
    849.4849243
    851.9153442
    853.1558838
    853.4482422
    851.1864624
    847.2114868
    841.1884766
    836.9008179
    833.5117188
    829.0596313
    824.793396
    820.3771362
    814.8267822
    801.9072266
    791.6320801
    785.4418335
    779.8200073
    771.2828979
    761.9196167
    750.3479004
    741.7773438
    738.2392578
    734.8656006
    742.4783936
    753.2993774
    758.5220337
    765.0108032
    773.8964844
    784.3497925
    791.5526733
    796.8803101
    796.1280518
    798.6417847
    805.6162109
    810.3208008
    812.8901367
    812.3065186
    811.3890381
    806.4616089
    800.0859985
    796.7346191
    794.9001465
    795.2747803
    798.843811
    801.078186
    801.0970459
    796.0614624
    791.7692871
    786.6804199
    782.4083252
    780.8256836
    778.5016479
    777.3447876
    767.9415283
    739.5866089
    721.8610229
    713.5126343
    705.6606445
    701.588623
    699.7987671
    702.8102417
    708.6174927
    709.5603027
    703.3974609
    705.015625
    699.3236084
    700.6368408
    709.8671875
    707.3671875
    696.5007935
    698.8795776
    719.9483032
    747.0145874
    758.7772827
    761.8144531
    757.6578979
    747.2991333
    735.8928223
    725.2272339
    716.5576782
    710.6534424
    704.1074219
    696.7088623
    687.4302368
    679.961731
    683.4918823
    693.5748901
    700.302063
    702.3838501
    706.0160522
    705.9127197
    700.0411377
    694.517334
    689.3287964
    684.4643555
    679.1867065
    676.3406982
    669.850769
    669.2459717
    672.3549805
    677.4022217
    677.5136108
    677.6033325
    676.1049194
    674.0685425
    674.164856
    672.7046509
    672.2843628
    670.1762695
    665.6199341
    661.8884888
    661.6439209
    663.3314819
    663.6298828
    663.7016602
    663.7848511
    663.1206055
    659.250061
    660.7438965
    657.5095215
    657.0581665
    655.8161011
    655.2440186
    653.2251587
    655.5886841
    652.6538696
    652.1986694
    649.8183594
    648.1289063
    650.9515991
    652.7393799
    658.1827393
    666.6615601
    672.1538696
    684.2106934
    691.9325562
    700.4051514
    708.8914795
    715.3389282
    718.3659058
    721.7544556
    721.5198975
    725.1262207
    732.3004761
    732.9890137
    735.3244629
    741.2077637
    741
    742.8363037
    743.104187
    740.3540649
    736.8208008
    734.0880127
    732
    732.3078613
    735.1635132
    738.8427734
    742.4220581
    747.1716309
    751.6264648
    756.2530518
    758.5056152
    760.5892334
    760.37854
    756.2872925
    754.489502
    751.6151123
    747.9125366
    744.8754272
    742.7459717
    740.043457
    738.5646973
    737.1298828
    735.3533325
    735.8851318
    735
    734.7937622
    734.5111694
    737.4768066
    736.3831787
    734.1768799
    732.4609375
    729.1187744
    726.2993164
    722.0071411
    716.750061
    712.5444946
    709.0446167
    704.6136475
    700.2866821
    697.7665405
    694.0715942
    692.4451294
    691.4432983
    695.0120239
    702.2420654
    706.49646
    707.7728271
    710.5786743
    708.3795776
    708.7061157
    706.5008545
    702.2949219
    701.3805542
    700.44104
    699.7839355
    699.8826294
    701.812439
    699.600647
    694.6970825
    691.3656616
    687.6914063
    683.1976929
    680.6400146
    677.2398682
    673.5336304
    669.3570557
    663.5679321
    659.7944946
    655.3724976
    648.4990234
    639.1396484
    635.1307983
    644.9985352
    656.3831787
    665.8095093
    675.6881104
    683.6167603
    690.9777832
    698.9271851
    706.8880005
    711.2512207
    715.5932617
    716.8433228
    717.0515747
    715.6864624
    712.697876
    708.512146
    705.182312
    699.8053589
    695.4187622
    687.736145
    680.4713745
    681.263855
    688.927124
    695.6837769
    698.0456543
    701.9215088
    702.5726318
    700.3711548
    696.6491699
    692.7776489
    688.4795532
    683.9367065
    676.2459106
    670.7229004
    661.963623
    652.4630737
    643.5394287
    633.5140991
    624.7471313
    628.8388062
    638.5716553
    641.520813
    641.6409912
    639.861145
    641.3475952
    650.2125854
    658.8436279
    665.4570313
    670.3126831
    674.8966064
    677.8043823
    680.0126343
    681.1925659
    682.9542236
    681.1275024
    678.6634521
    675.0247803
    670.3644409
    663.3201294
    657.7198486
    654.6317139
    650.4338379
    644.0994873
    643.1893921
    649.7035522
    654.3077393
    659.5251465
    663.6779785
    669.8632813
    675.940918
    678.9255981
    680.9309692
    684.1931152
    688.7619629
    690.1939697
    689.1552734
    686.4268799
    684.6618652
    681.5685425
    676.6575317
    672.7608032
    675.022644
    679.5587769
    681.9800415
    685.0722046
    686.5222778
    687.0299072
    686.2755737
    685.6276245
    683.8491211
    679.9450073
    676.7575073
    671.5460815
    663.3384399
    658.2334595
    665.3518066
    671.1566772
    675.0319214
    676.8850708
    676.550415
    676.3436279
    674.1685791
    675.8384399
    671.2337646
    662.4356079
    655.2803955
    653.2050781
    656.9694214
    661.7299194
    667.8068237
    672.8585205
    675.5122681
    677.161438
    679.6081543
    682.2486572
    682.3450317
    680.2711792
    677.3845825
    673.0661011
    667.3389282
    661.7272949
    657.8352051
    652.1201782
    646.680542
    642.4492798
    636.3059082
    633.0790405
    630.4816895
    628.4041748
    625.3918457
    622.6369629
    623.2254639
    627.7310181
    632.1109009
    631.7994995
    630.0335693
    623.6503906
    617.5916138
    610.8655396
    608.9365234
    607.1260376
    606.6655884
    608.9882813
    609.3581543
    602.9796753
    600.6970215
    597.873291
    596.2045288
    596.5969238
    598.703125
    606.1618652
    608.7360229
    607.9777832
    613.109436
    621.3206177
    627.442749
    631.8341064
    631.5507813
    626.8806152
    621.1746216
    613.3198242
    602.5357056
    601.1797485
    613.579834
    623.9292603
    631.6599121
    638.2144775
    645.1256714
    649.6599731
    652.6139526
    654.9349976
    654.218811
    653.6445923
    651.7567139
    648.1748657
    645.8465576
    642.0876465
    637.6447754
    634.8436279
    626.7710571
    619.656189
    612.9226685
    605.9169922
    598.5823364
    591.1447144
    588.0195313
    598.479126
    606.3743896
    617.4630737
    622.7449341
    621.1248169
    616.8311768
    612.0311279
    603.9886475
    596.9522095
    597.4367676
    605.7645264
    612.2410889
    621.1799316
    630.1050415
    630.1669922
    631.3269043
    627.1201782
    624.6369019
    628.427063
    633.579834
    636.8123169
    637.9957886
    636.463623
    635.3522949
    634.0200195
    633.6658936
    630.0128174
    625.8214111
    625.8406372
    625.1143188
    624.2523804
    624.458252
    622.7558594
    620.1221924
    618.2224121
    613.8261108
    609.4934692
    602.4368286
    595.7553101
    585.9816284
    578.8660889
    577.8017578
    582.1530762
    585.7706909
    586.5403442
    590.2040405
    594.4072266
    597.0517578
    599.3001709
    598.6359253];

plot(d,a,'k');
xlabel('Distancia (km)');
ylabel('Altitude (m)');
title('Perfil de elevacao');
axis([-10 75 550 930]);
x1 = d(1);
y1 = a(1);
txt1 = 'Sao Carlos \rightarrow';
text(x1,y1,txt1,'HorizontalAlignment','right')
x1 = d(length(d));
y1 = a(length(a));
txt1 = '\leftarrow Matao';
text(x1,y1,txt1)

% Parametros da elipse:
x1 = d(1);
y1 = a(1);
x2 = d(length(d));
y2 = a(length(a));
x0 = (x2-x1)/2;
y0 = (y2-y1)/2 + a(1);
ra = sqrt((y2-y1)^2 + (x2-x1)^2)/2;
ang = atan((y2-y1)/(x2-x1));

% Parametros da zona de Fresnel:
d1 = sqrt((y2-y1)^2 + (x2-x1)^2);
d2 = d1;
h = sqrt(lambda*(d1*d2)/(d1+d2));
rb = h;

% Desenhando a Zona de Fresnel:
figure;
plot(d,a,'k');
title('Formato da Zona de Fresnel sem elevacao');
xlabel('Distancia (km)');
ylabel('Altitude (m)');
axis tight;
ellipse(ra,rb,ang,x0,y0);
ellipse(ra,0.6*rb,ang,x0,y0,'r'); % 60% da zona de Fresnel

figure;
% Estipulando alturas para as antenas:
Tx = 25; %m
Rx = 30; %m

% Parametros da elipse:
x1a = d(1);
y1a = a(1) + Tx;
x2a = d(length(d));
y2a = a(length(a)) + Rx;
x0a = (x2a-x1a)/2;
y0a = (y2a-y1a)/2 + y1a;
raa = sqrt((y2a-y1a)^2 + (x2a-x1a)^2)/2;
anga = atan((y2a-y1a)/(x2a-x1a));

% Desenhando a Zona de Fresnel:
plot(d,a,'k');
xlabel('Distancia (km)');
ylabel('Altitude (m)');
title('Zona de Fresnel com antenas de altura Tx = 25m e Rx = 30m');
axis tight;
ellipse(raa,rb,anga,x0a,y0a);
ellipse(raa,0.6*rb,anga,x0a,y0a,'r'); % 60% da zona de Fresnel
legend('Perfil de elevacao', '1a Zona de Fresnel',...
    '60% da 1a Zona de Fresnel');

% Banda de frequencia:
Pe = 1e-6;
BWrel = 0.33; %(* Rb)
BW = BWrel*Rb %MHz

% SNR para Eb/N0 = 14dB (Pe = 1e-6)
EbN0dB = 14; %dB
EbN0 = 10^(EbN0dB/10);
SNR = EbN0*Rb/BW
SNRdB = pow2db(SNR)

% Temperatura de ruido da antena:
Kb = 1.38e-23; %J/K
Tb = 290; %K
N0 = Kb*Tb*BW %W
N0dB = 10*log10(N0/1e-3) %dBm
    % para SNR = 76.18:
S0 = SNR*N0 %W - Potencia minima de recepcao
S0dB = 10*log10(S0/1e-3) %dBm

% Potencias:
R = sqrt((a(1)+Tx-a(length(a))+Rx)^2 +...
    ((1000*(d(1)-d(length(d))))^2)); %m - distancia entre antenas
% Gt = 41.5; %dBi - antenna 901-HAA1312_00-PA2 - diametro: 1.2m
Gt = 35.8; %dBi - antenna 901-HAA1306_00-PA2 - diametro: 0.6m
Gr = Gt; %dBi
L = 20*log10(4*pi*R/lambda); %dB - Atenuacao de percurso
Lc = 40; %dB - Atenuacao por chuva

PtdB = S0dB -(Gt + Gr - L - Lc) %dBm - Potencia minima de transmissao (dBm)
Pt = 1e-3*10^(PtdB/10) %W

% Potencia transmitida com margem de enlace:
Pt = 3 %W
PtdB = 10*log10(Pt/1e-3) %dBm
PrdB = PtdB + Gt + Gr - L - Lc %dBm
Pr = 1e-3*10^(PrdB/10) %W
SNR = Pr/N0
SNRdB = 10*log10(SNR)
EbN0 = SNR*BW/Rb
EbN0dB = 10*log10(EbN0)
% Probabilidade de erro < 10^8





